<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
<title>LCUI &#8250; 动态 &#8250; 开发日志</title>
<link rel="icon" href="lc-soft.png" type="image/png">
<meta name="keywords" content="GUI,LCSoft,LCDT,LCUI,Embedded,linux,liuchao,opensource,freesoft,C" >
<meta name="description" content="LCUI 0.14.0 开发日志" >
<meta name="robots" content="all" >
<meta name="author" content="LC-Soft" >
<link type="text/css" rel="stylesheet" href="../files/css/main.css"> 
<link type="text/css" rel="stylesheet" href="../files/css/dev_log.css"> 
</head>
  <body style="margin-top: 100px;"class="my_body"> 
    <script type="text/javascript" src="../files/js/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" src="../files/js/ms-script.jsx"></script>
    <script type="text/javascript" src="../files/js/menu-effect.js"></script>
    <script type="text/javascript" src="../files/js/titlemenu.zh-cn.js"></script> 
    <script type="text/javascript" src="../files/audiojs/float_musicplayer.js"></script> 
	
	<div style="padding-top: 30px;"> 

    <!-- 上面是标题栏区域 --> 
<div class="entry-content">
<center><h1>LCUI 0.14.0</h1></center>
<hr>
<p>此版本中计划完成的任务：
<ul>
<li>为部件添加过渡效果，位置变化、尺寸变化、图形重绘、显示、隐藏都支持该效果。</li>
<li>bmp目录下，添加jpeg、bmp图片文件的写入函数,调整图片文件的读写函数。</li>
<li>(待添加)</li>
</ul>
</p>
<h2>2013-3-11</h2>
<p>发现了一个募捐项目：Civitas，它是一个城市建设游戏，据说EA公司 推出的《模拟城市5》没以前的好了。看图中的内容，该游戏貌似支持linux系统，具体信息可到这了解：<a href="http://www.kickstarter.com/projects/1584821767/civitas-plan-develop-and-manage-the-city-of-your-d" target="_blank">http://www.kickstarter.com/projects/1584821767/civitas-plan-develop-and-manage-the-city-of-your-d</a>，可惜条件不允许，不能捐钱。</p>
<h2>2013-3-12</h2>
<p>准备搞个游戏，已经有了素材，先弄个地图编辑器，把地图信息搞好并保存至文件，这样游戏就能载入并解析该文件，然后生成地图。</p>
<p>想在windows上搞，但是有个未解决的问题：不能正常读取png图片信息，到底需要修改哪里？</p>
<p>重新创建了一个VS2012项目，只复制之前的文件列表和筛选器，剩下的配置由自己重新设置。</p>
<p>写了个png测试程序，程序使用LCUI函数库，测试打开一个图片文件，打印的结果正常：channels=4，color_type=6，但使用graph2array测试程序load_png函数时，打印的结果是：channels=4，color_type=1780891744，什么情况？图片数据能正常读出来。记得在修改png.c文件前的测试中，打印的chnnels也是一个非常大的值，连图片数据都读不出。</p>
<p>代码已经提交，<a href="https://github.com/lc-soft/LCUI/commit/16964856a3865f3701a5b698483dec01e6ff4c8a" target="_blank">可到这里</a>查看修改情况，只是修改了png.c，看起来代码没多大变化，我想知道这代码与之前的有什么区别？为啥改了后就能正常读png图片了？难道是项目配置的问题？</p>
<h2>2013-3-13</h2>
<p>定时器出了点问题，非要鼠标移动时，它才定时器的回调函数才会被调用，个人猜测是GetMessage函数的问题，它在LCUI的主循环里阻塞等待消息，导致LCUI的任务无法及时处理。</p>
<p>解决方法：用PeekMessage函数代替GetMessage函数即可，可以当成是GetMessage函数的非阻塞版本。</p>
<p>额，原来是忘记保存定时器的ID，调用reset_timer和free_timer函数时，传的值是-1，怪不得怎么没用。</p>
<p><a href="https://github.com/lc-soft/LCUI/commit/f65712adad88bbb865eac2c5cb286ec90dc51fb6" target="_blank">修改了LAYOUT_TYPE枚举中各个宏定义的值</a>，这是为了解决Graph_FillImage函数不能正常解析出布局方式的问题，传给Graph_FillImage函数的参数，有一个是保存了布局方式和图形混合方式，在进行与运算后，就能正常得出是哪一个布局方式。<p>
<p><a href="http://lcui.org/files/images/devlog/2013-03-13-21-53-35.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/devlog/2013-03-13-21-53-35.png"
	alt="" width="320" height="240">
</a></p>
<p>地图图块 窗口中的各个按钮的定位类型是STATIC，但有点问题，linux下，第7个按钮要在我点窗口时才会显示，而在windows下，只显示4个按钮，奇怪。<p>
<h2>2013-3-14</h2>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI/commit/ee81a7b2651f2f54b7ffae045f7be182e405b41c">解决了一个BUG</a>：主要独立出“位置更新”和“位置改变”这两种不同的操作，该BUG会导致部件位置无法正常调整，在未修改前，这两个操作可以相互覆盖，也就是Widget_Move任务被覆盖掉了。</p>
<p>修改后，STATIC定位类型的部件的位置处理在linux下是正常了，而在windows上，还是有问题，暂时不用这个功能自动调整部件坐标，自己另外加几段代码算出来。</p>
<h2>2013-3-15</h2>
<p>每次关闭LCUI的窗口时，程序都会出现“已停止工作”，无视也不是办法，还是先解决这个问题，调试时VisualStudio中有函数调用栈，能够定位BUG大致位置。</p>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI/commit/979d2645a51dc5a565ab56a6504a0e2f2bbeb9fb">修改了一下主循环的代码。</a></p>
<p>改了后，LCUI程序一运行就会出现“已停止工作”，刚开始以为是偶然的问题，试了几次后，都是这问题，函数调用栈中表明是set_timer函数的问题，看了一下代码，唯一能引起问题的是LCUIApp_GetSelf()->id这段代码了，如果LCUIApp_GetSelf()得到的指针为NULL或无效，那么后面的->id就会出问题，数据访问越界。<a target="_blank" href="https://github.com/lc-soft/LCUI/commit/efe74bb154550205fe18c3988a7302bf92e90990">于是就改成LCUIApp_GetSelfID()</a>。</p>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI/commit/33bccd15bfc4dbd3613bba3996a8e776f51b3735">修复win32线程支持模块中存在的BUG</a>：该BUG会导致在调用LCUIThread_Join函数时无法得到正确的线程句柄，访问了非法的内存地址。
现在，已经能够在Win32平台下正常退出程序了。</p>
<h2>2013-3-16</h2>
<p>新写的MapBox部件无法显示地图块，正打算往MapBox_CreateMap里添加Graph_PrintInfo函数调用，发现该函数居然对MapBox的地图资源进行初始化，这个操作应该在MapBox_ExecInit里执行的，这里居然也有，怪不得怎么不能绘制出地图。</p>
<p>还有问题，一绘制地图就会导致程序崩溃。</p>
<p>折腾了一段时间，发现下标异常，绘制第一张地图块，下标不是0，而是个很大的数。在添加用于调试的代码时，发现了问题原因，问题出在block[i]->id = 0上，编译器在编译时居然没给警告，改正后为：block[i][j]->id = 0。</p>
<p>改了一下窗口在未获得焦点时使用的背景色。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-16-20-15-12.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-16-20-15-12.png"
	alt="" width="802" height="602">
</a></p>
<p>地图编辑器的源代码已经上传至GitHub：<a target="_blank" href="https://github.com/lc-soft/LCUI-2DMapEditor">https://github.com/lc-soft/LCUI-2DMapEditor</a>,Makefile之类的就没写了，直接gcc编译每个.c文件，最后在链接时把LCUI函数库链接进去就行了，Windows下的话，创建新项目，把它们添加进去，设置好头文件及库的目录位置，就能进行编译。</p>
<p>现在的地图编辑器还需要进行完善，具体功能需求如下：<br>
<ul>
<li>能响应鼠标移动和鼠标单击，当鼠标移动时，在鼠标游标覆盖的地图块上显示高亮边框，当点击鼠标左键时，更改该地图块的内容。</li>
<li>对于大地图，能响应鼠标拖动，移动地图显示区域。</li>
<li>需要添加一些按钮，以对地图块进行旋转和翻转。</li>
<li>能够载入地图文件中的数据，也能将地图数据写入至文件中。</li>
</ul>
<h2>2013-3-16</h2>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI-2DMapEditor/commit/611911aed18d5a94728ed74de345a70c993a8e6d">完成了MapBox部件的鼠标移动事件的响应功能</a>，鼠标游标移动至一块地图块上，该地图块就会有红色边框显示。调试过程中遇到的问题不难解决，在以前就遇到过不少次，只不过需要些时间罢了。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-17-17-14-08.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-17-17-14-08.png"
	alt="" width="320" height="240">
</a></p>
<p>但是，坐标判断不准确，地图是菱形的，而判断时使用的是矩形，即使不在地图块菱形区域内，只要在该地块的矩形范围内，该地图块还是会显示红色边框。</p>
<h2>2013-3-17</h2>
<p>添加了地图块选定功能，以后添加的地图块翻转功能的操作对象就是被选中的地图块。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-17-20-44-07.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-17-20-44-07.png"
	alt="" width="320" height="240">
</a></p>
<h2>2013-3-18</h2>
<p>话说，对于菱形地图块，旋转功能不适用，只需要水平翻转和垂直翻转功能。</p>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI-2DMapEditor/commit/24505effd0b94f3f99bfe201a26e59715ec7a853">完成了地图编辑器的基本功能</a>，从“地图图块”窗口里选择地图块，然后在“地图编辑器”窗口中点击，即可将地图块贴至地图上。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-18-13-15-06.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-18-13-15-06.png"
	alt="" width="802" height="602">
</a></p>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI-2DMapEditor/commit/f4b113c266defaa52581b6b22b4f49826ff97009">添加了地图块水平翻转功能</a>，Graph_HorizFlip函数不能处理引用图像，<a target="_blank" href="https://github.com/lc-soft/LCUI/commit/56797355128ae72a5b71760faf27b53d263efaa1">修改了一下它的代码</a>，还需要为LCUI添加图像垂直翻转功能。</p>
<p>添加了两个按钮，用于对选中的地图块进行水平翻转和垂直翻转，起初想找现成的图片作为按钮图标，但还是算了，自己用PS画了两个简单的图。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-18-22-52-14.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-18-22-52-14.png"
	alt="" width="802" height="602">
</a></p>
<h2>2013-3-19</h2>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI/commit/a3c5f86957b2eb499272678ff77b91d2c18f380b">为LCUI添加了图像垂直翻转功能</a>。</p>
<p><a target="_blank" href="https://github.com/lc-soft/LCUI-2DMapEditor/commit/550a13412b59d08657b9cba80d2c61fbb664ea50">地图块的垂直翻转功能已经完成</a>，接下来需要添加地图尺寸调整功能，以及地图数据的保存和读取。</p>
<p><a href="http://lcui.org/files/images/game/2013-03-19-13-22-15.png">
	<img class="alignnone" title="地图编辑器" src="http://lcui.org/files/images/game/2013-03-19-13-22-15.png"
	alt="" width="802" height="602">
</a></p>
</div>
<!-- Duoshuo Comment BEGIN -->
	<a id="blog-comment"></a>
	<div class="ds-thread" data-thread-key="9" data-title="LCUI 0.14.0" data-category="LCUI-Dev"
	data-url="http://www.lcui.org/zh-cn/devlog-lcui-0.14.0.html">
	</div>
<!-- Duoshuo Comment END -->
    <!-- 网页底部的内容 -->
    <hr>
    <table class="my_style" width="100%">
      <tr>
        <td align="left">
          网页由
          <a href="mailto:lc-soft@live.cn">
            刘超
          </a>
          维护
        </td> 
        <td align="right">
          <a target="_blank" href="http://validator.w3.org/check/referer">
            <img border=0 src="http://www.w3.org/Icons/valid-html401-blue" alt="Valid HTML 4.0!"
            height=31 width=88>
          </a>
        </td>
      </tr>
      <tr>
        <td>
          最后更新: 2013-03-19
        </td> 
        <td align="right">
		<a target="_blank" href="http://sighttp.qq.com/authd?IDKEY=af7bcac3a71b6cf237e715c4f3beffc6e53bdf1075cb4674">
		  <img border="0" src="http://wpa.qq.com/imgd?IDKEY=af7bcac3a71b6cf237e715c4f3beffc6e53bdf1075cb4674&amp;pic=45" alt="通过QQ与作者进行交流" title="通过QQ与作者进行交流"></a>
          <script type="text/javascript" src="../files/js/baidu-code.js">
          </script>
		  <script src="http://s23.cnzz.com/stat.php?id=4262888&amp;web_id=4262888&amp;show=pic1" type="text/javascript"></script>
        </td>
      </tr>
    </table>
  </div>
  </body>



</html>
<!-- page-front.tpl -->
