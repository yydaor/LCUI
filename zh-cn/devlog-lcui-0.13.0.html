<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>
			LCUI &#8250; 动态 &#8250; 开发日志
		</title>
		<link rel="icon" href="lc-soft.png" type="image/png">
		<meta name="keywords" content="GUI,LCSoft,LCDT,LCUI,Embedded,linux,liuchao,opensource,freesoft,C">
		<meta name="description" content="LCUI 0.13.0 开发日志">
		<meta name="robots" content="all">
		<meta name="author" content="LC-Soft">
		<link type="text/css" rel="stylesheet" href="../files/css/main.css">
		<link type="text/css" rel="stylesheet" href="../files/css/dev_log.css">
	</head>
	<body style="margin-top: 100px;" class="my_body">
		<script type="text/javascript" src="../files/js/jquery-1.8.1.min.js">
		</script>
		<script type="text/javascript" src="../files/js/ms-script.jsx">
		</script>
		<script type="text/javascript" src="../files/js/menu-effect.js">
		</script>
		<script type="text/javascript" src="../files/js/titlemenu.zh-cn.js">
		</script>
		<script type="text/javascript" src="../files/audiojs/float_musicplayer.js">
		</script>
		<div style="padding-top: 30px;">
			<!-- 上面是标题栏区域 -->
			<div class="entry-content">
				<center> <h1> LCUI 0.13.0 </h1> </center>
				<hr>
				<h2> 2012-12-17 </h2>
				<p>LCUI 0.12.6有点赶脚，发布这个版本后，感觉自己自由了，歇息了几天。</p>
				<p>现在先写下这次版本更新中需要实现的东西：<br>
				能够够直接读取图片的信息，之前的版本，都是先读取图片数据，再从图片数据中获取图片信息。<br>
				实现部件的圆角边框绘制，阴影绘制。<br>
				文本框添加占位符功能，文本框为空并未处于焦点状态时，显示占位符。<br>
				图形处理上，为LCUI_Graph结构体添加auto_attr属性（attr是attribute的缩写），用于指示是否在每次修改图形数据后，自动更新该图形的属性；<br>
				解除每次操作图形时的加锁和解锁操作，因为有时频繁修改图形时，这加锁和解锁的操作，以及图形属性的自动更新，会浪费很多时间。<br>
				队列处理上，也一样，解除每次操作队列时的加锁和解锁操作，需要加锁时直接调用Queue_Lock或Queue_Using函数即可。<br>
				以后需要移植到windows上，那么，如何避免与windows的函数库内的函数同名？例如：RGB函数。<br>
				要么，重新调整函数名，加个LCUI前缀名，再用宏定义，将目前使用简写的函数名替换成原本的函数名，这个以后再考虑，现在懒得纠结。<br>
				其它的功能，在开发过程中再考虑。</p>
				<p>
				有个想法：<br>
				部件的样式能够像html网页那样用css来定义网页元素的样式，贴个示例代码：<br>
				char wnd_css[]= {<br>
				".my_style {"<br>
				"width:320px;"<br>
				"height: 240px;"<br>
				"align:middle-center;"<br>
				"title-text:测试窗口;"<br>
				}<br>
				CSSLib_Add_New( wnd_css );<br>
				Set_Widget_Class( window, "my_style" );<br>
				调用CSSLib_Add_New函数把这个样式载入至样式库，然后调用Set_Widget_Class函数将库中的my_style类样式应用到window部件上。<br>
				CSSLib_Add_New函数是CSSLib模块里的，而Set_Widget_Class函数通过该模块的函数获取相应的样式，并应用到window部件上。<br>
				每种部件应该关联一个函数，用于处理这些样式。</p>
				<h2>2012-12-21</h2>
				<p>整理了一下头文件，部件的源文件和头文件，文件名都改成小写，并去掉LCUI_前缀名，部件的头文件，都转移至include/LCUI/widget/目录下。</p>
				<p>LCUI_Font.h头文件也做了修改，一个头文件包含多个源文件中的函数声明、结构体定义、宏定义，维护起来有点麻烦，我把它缩减了。</p>
				<p>textlayer.c、charset.c、bitmapfont.c等都有自己的头文件，而LCUI_Font.h只是#include这些头文件，它们的头文件都存放在include/LCUI/font/目录下。</p>
				<p>从textlayer.c中分离出了textstyle.c，主要分离了TextStyle相关的结构体和函数，打算再从textlayer.c中分离出文件样式标签处理模块，转移到textstyle.c里。</p>
				<p>git居然能够知道我更改了文件名，不错不错，本以为它会把更名后的文件当新文件对待。</p>
				<h2>2012-12-23</h2>
				<p>圆形边框绘制有点棘手，写了个测试网页，以下是效果图：</p>
				<p><a href="http://lcui.org/files/images/devlog/2012-12-23-16-26-07.png">
					<img class="alignnone" title="圆角绘制" src="http://lcui.org/files/images/devlog/2012-12-23-16-26-07.png"
					alt="" width="133" height="113">
				</a></p>
				<p>div的样式为：“width:100px; height: 100px; border-left:5px solid #000;border-top-left-radius:45px;"<br>
				宽高都为100px，左边框的大小为5px，实线，黑色，左上角的圆角半径为45px。<br>
				从左边框开始，线条逐渐变细，直到上边框的左端为止，这是怎么绘制的？
				</p>
				<p>完成了左上角的圆角绘制，效果如图所示：</p>
				<p><a href="http://lcui.org/files/images/devlog/2012-12-23-20-51-18.png">
					<img class="alignnone" title="测试圆角边框" src="http://lcui.org/files/images/devlog/2012-12-23-20-51-18.png"
					alt="" width="320" height="240">
				</a></p>
				<p>只是绘制线条而已，边框以外的图形并未进行透明处理；这线条并不是连续的，不像一个圆滑的曲线，有锯齿。<br>
				要使绘制出来的线条抗锯齿的话，那就在该点周围添加点，像素点的坐标越是接近计算出来的xy的值，那么，该像素的的颜色越深，反之，越淡。<br>
				说是这样说的，有待继续实验。</p>
				<h2>2012-12-25</h2>
				<p>上图中，从左下角到右上角，点的密度会越来越低，从y轴上看，每一行最多2个点；从x轴上看，有的列却没有一个点。</p>
				<p>圆需要绘制2次，一次是根据y轴计算各点的x轴坐标并填充点，一次是根据x轴计算各点的y轴坐标并填充点；前面一次，每1行最多两个点；而后一次，每1列最多两个点，这样,这些点就能补全整个圆。</p>
				<h2>2012-12-28</h2>
				<p>在实现x轴的各点填充时出现问题，点是乱的，后来发现，是由于没有将double型y轴坐标转换成int型，导致运算结果异常。</p>
				<p>经过一番优化后，已经实现圆的绘制，具体如下图所示：</p>
				<p><a href="http://lcui.org/files/images/devlog/2012-12-28-13-38-14.png">
					<img class="alignnone" title="测试圆的绘制" src="http://lcui.org/files/images/devlog/2012-12-28-13-38-14.png"
					alt="" width="320" height="240">
				</a></p>
				<p><a target="_blank" href="https://github.com/lc-soft/LCUI/blob/06407d48a0b0fda68e80c15a295ff38689e5c26b/src/draw/border.c#L60">可到这里</a>查看圆的绘制代码，其实在绘制1/4圆的同时，就可以绘制剩下的3/4圆。</p>
				<p>接下来就是添加区域有效性处理，绘制的圆可能会超出目标图层的范围，应该确保在绘制圆的时候不超出范围，以避免内存访问越界。</p>
				<p>圆角绘制已经完成，如下图所示：</p>
				<p><a href="http://lcui.org/files/images/devlog/2012-12-28-15-00-00.png">
					<img class="alignnone" title="测试圆角边框的绘制" src="http://lcui.org/files/images/devlog/2012-12-28-15-00-00.png"
					alt="" width="320" height="240">
				</a></p>
				<p><a target="_blank" href="https://github.com/lc-soft/LCUI/blob/c508bd12fde4a9a728a2213976c7aeddf939b88b/src/draw/border.c#L60">这是修改后的代码</a>，圆角边框的线条粗细不能调整，有待完善，圆外的区域透明处理还算比较简单。</p>
				<p>不同粗细的圆角边框线条绘制，可以根据粗细程度，绘制相应数量的圆，例如：线条宽度为5px，那么，需要绘制5个同心圆，它们的半径分别为：5、4、3、2、1，这样就组成了一个线条宽度为5px的圆了。</p>
				<p>自定义线条宽度的圆角绘制已经实现，<a target="_blank" href="https://github.com/lc-soft/LCUI/blob/eccd07e9f7fe22ba2cc4303033b1d511311b712b/src/draw/border.c#L178">可到这里</a>查看修改后的代码，以下是效果图：</p>
				<p><a href="http://lcui.org/files/images/devlog/2012-12-28-15-38-24.png">
					<img class="alignnone" title="测试圆角边框的绘制" src="http://lcui.org/files/images/devlog/2012-12-28-15-38-24.png"
					alt="" width="320" height="240">
				</a></p>
				<p>边框线条宽度为20px，圆角线条里还有一些点没有被填充，看来真的需要实现之前说的那个 圆的抗锯齿处理了。</p>
			</div>
			<!-- Duoshuo Comment BEGIN -->
			<a id="blog-comment">
			</a>
			<div class="ds-thread" data-thread-key="8" data-title="LCUI 0.13.0" data-category="LCUI-Dev"
			data-url="http://www.lcui.org/zh-cn/devlog-lcui-0.13.0.html">
			</div>
			<!-- Duoshuo Comment END -->
			<!-- 网页底部的内容 -->
			<hr>
			<table class="my_style" width="100%">
				<tr>
					<td align="left">
						网页由
						<a href="mailto:lc-soft@live.cn">
							刘超
						</a>
						维护
					</td>
					<td align="right">
						<a target="_blank" href="http://validator.w3.org/check/referer">
							<img border=0 src="http://www.w3.org/Icons/valid-html401-blue" alt="Valid HTML 4.0!"
							height=31 width=88>
						</a>
					</td>
				</tr>
				<tr>
					<td>
						最后更新: 2012-12-28
					</td>
					<td align="right">
						<a target="_blank" href="http://sighttp.qq.com/authd?IDKEY=af7bcac3a71b6cf237e715c4f3beffc6e53bdf1075cb4674">
							<img border="0" src="http://wpa.qq.com/imgd?IDKEY=af7bcac3a71b6cf237e715c4f3beffc6e53bdf1075cb4674&amp;pic=45"
							alt="通过QQ与作者进行交流" title="通过QQ与作者进行交流">
						</a>
						<script type="text/javascript" src="../files/js/baidu-code.js">
						</script>
						<script src="http://s23.cnzz.com/stat.php?id=4262888&amp;web_id=4262888&amp;show=pic1"
						type="text/javascript">
						</script>
					</td>
				</tr>
			</table>
		</div>
	</body>
</html>
<!-- page-front.tpl -->
